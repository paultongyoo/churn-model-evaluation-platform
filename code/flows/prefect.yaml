name: flows
prefect-version: 3.4.8

build:
- prefect_docker.deployments.steps.build_docker_image:
    id: build_image
    requires: prefect-docker>=0.3.1
    image_name:  local-flow-image # This will be overridden by the GitHub Actions workflow
    tag:  latest
    dockerfile: Dockerfile

push:
- prefect_docker.deployments.steps.push_docker_image:
    requires: prefect-docker>=0.3.1
    image_name: '{{ build_image.image_name }}'
    tag: '{{ build_image.tag }}'

pull:
- prefect.deployments.steps.pip_install_requirements:
    directory: "{{ pull_code.directory }}"
    requirements_file: requirements_extra.txt
- prefect.deployments.steps.set_working_directory:
    directory: /opt/prefect/flows

deployments:
- name: default
  entrypoint: churn_prediction_pipeline.py:churn_prediction_pipeline
  work_pool:
    name: mlops-churn-pipeline-pool
    type: ecs
    job_variables:
      image: '{{ build_image.image }}'
